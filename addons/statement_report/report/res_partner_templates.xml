<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
	<!-- Statement report template-->
	<template id="res_partner_statement_report_template">
		<t t-call="web.html_container">
			<t t-call="web.external_layout">
				<div page="page">
					<h3 class="text-left mb-2">
						<t t-esc="customer"/>
					</h3>
					
					<div class="d-flex">
						<div class="w-50">
						</div>
						<div class="w-50 text-center py-1"
						     t-attf-style="background-color:#093671 !important; color:#fff !important;">
							<h4 class="mb-0"
							    t-attf-style="text-transform: uppercase !important; letter-spacing: 3px !important;">
								Statement of Accounts
							</h4>
							<span t-if="today">Aging Report as of
								<span t-esc="today"/>
							</span>
							<span t-else="">Aging Report</span>
						</div>
					</div>
				</div>
				
				<table class="table mt-4" style="align-items: center;">
					<thead>
						<tr>
							<th>Date</th>
							<th>Invoice/Bill Number</th>
							<th>Over Dues</th>
							<th>Invoices/Debit</th>
							<th>Balance</th>
						</tr>
					</thead>
					<tbody>
						<t t-set="total_balance" t-value="0"/>
						<t t-set="total_inv_amount" t-value="0"/>
						<!--Looping the data-->
						<t t-foreach="my_data" t-as="line">
							<t t-set="balance" t-value="abs(line['balance'])"/>
							<t t-set="inv_amount" t-value="abs(line['sub_total'])"/>
							<t t-set="total_balance" t-value="total_balance + balance"/>
							<t t-set="total_inv_amount" t-value="total_inv_amount + inv_amount"/>
							
							<tr>
								<td align="center">
									<t t-esc="line['invoice_date']"/>
								</td>
								<td align="center">
									<t t-esc="line['name']"/>
								</td>
								<td align="center">
									<t t-esc="line['due_days']"/>
								</td>
								<td align="right">
									<t t-esc="'{0:,.2f}'.format(abs(line['sub_total']))"/>
								</td>
								<td align="right">
									<t t-esc="'{0:,.2f}'.format(total_balance)"/>
								</td>
							</tr>
						</t>
						<tr t-attf-style="border-top: 2px solid black !important; border-bottom: 2px solid black !important;">
							<td colspan="6" align="center">
								<b>On Account Payments</b>
							</td>
						</tr>
						<!--PAYMENTS ROW-->
						<t t-foreach="payments" t-as="p">
							<t t-set="amount" t-value="abs(p.get('amount'))"/>
							<t t-set="total_balance" t-value="total_balance - amount"/>
							<tr>
								<td align="center">
									<span t-esc="p.get('date')"/>
								</td>
								<td align="center">
									<span t-esc="p.get('name')"/>
								</td>
								<td align="center">
								</td>
								<td align="right">
									-
									<span t-esc="'{0:,.2f}'.format(abs(p.get('amount')))"/>
								</td>
								<td align="right">
									<span t-esc="'{0:,.2f}'.format(total_balance)"/>
								</td>
							</tr>
						</t>
					</tbody>
				</table>
				<!--If there is total then below fields are visible-->
				<t t-if="total">
					<div class="clearfix" name="so_total_summary">
						<div id="total" class="row" name="total">
							<div t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'} ms-auto">
								<table class="table table-sm">
									<tbody>
										<tr>
											<td>Total Invoice Amount</td>
											<td class="text-right">
												<t t-esc="currency"/>
												<span t-esc="'{0:,.2f}'.format(total_inv_amount)"/>
											</td>
										</tr>
										<tr>
											<td t-attf-style="background-color:#093671 !important; color:#fff !important;">
												Due Amount
											</td>
											<td class="text-right"
											    t-attf-style="background-color:#093671 !important; color:#fff !important;">
												<t t-esc="currency"/>
												<t t-esc="'{0:,.2f}'.format(total_balance)"/>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</t>
			</t>
		</t>
	</template>
</odoo>
