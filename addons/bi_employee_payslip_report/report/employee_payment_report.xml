<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="employee_payment_report" model="ir.actions.report">
        <field name="name">Employee Payment Report</field>
        <field name="model">hr.payslip</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">bi_employee_payslip_report.employee_payment_report_id</field>
        <field name="report_file">bi_employee_payslip_report.employee_payment_report_id</field>
        <field name="binding_model_id" ref="hr_payroll.model_hr_payslip"/>
        <field name="binding_type">report</field>
    </record>

    <template id="employee_payment_report_id">
        <t t-call="web.external_layout">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-set="o" t-value="o.with_context(lang=lang)"/>
                    <div class="page">
                        <h2 class="text-center">
                            <span>
                            <u>Employee Payment Report</u>
                        </span>
                    </h2>
                    <h2 t-field="o.name" class="mt-4"/>
                    <table name="employee-infos" class="table table-sm table-bordered">
                        <tr>
                            <td>Company Name</td>
                            <td>
                                <span t-field="o.employee_id.company_id.name"/>
                            </td>
                            <td>Printed Date &amp; Time</td>
                            <td>
                                <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Employee Name</td>
                            <td>
                                <span t-field="o.employee_id.name"/>
                            </td>

                            <td>Wages Type</td>
                            <td>
                                <span t-field="o.struct_id.name"/>
                            </td>
                        </tr>
                        <tr>
                            <td>Employee Id</td>
                            <td>
                                <span t-field="o.employee_id.barcode"/>
                            </td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>Period</td>
                            <td>
                                <span t-field="o.date_from"/>
                                -
                                <span t-field="o.date_to"/>
                            </td>
                            <td></td>
                            <td></td>

                        </tr>
                    </table>

                    <table class="table table-sm table-bordered" name="payment_line_table">
                        <thead>
                            <tr>
                                <th  class="text-center">
                                    <strong>Month</strong>
                                </th>
                                <th class="text-center">
                                    <strong>Ref.</strong>
                                </th>
                                <th class="text-center">
                                    <strong>Debit (Payment)</strong>
                                </th>
                                <th class="text-center">
                                    <strong>Credit (Payable)</strong>
                                </th>
                                <th class="text-center">
                                    <strong>Balance</strong>
                                </th>
                            </tr>
                        </thead>
                        <t t-set="payment_data" t-value="o.get_payment_data()"/>
                        <tbody class="invoice_tbody">
                            <t t-set="total_debit" t-value="0"/>
                            <t t-set="total_credit" t-value="0"/>
                            <t t-set="total_balance" t-value="0"/>
                        <t t-foreach="payment_data" t-as="line">
                            <tr>
                                <td><span t-esc="line['month']"/></td>
                                <td><span t-esc="line['ref']"/></td>
                                <td class="text-right"><span t-esc="'%.2f' %line['debit']"/></td>
                                <td class="text-right"><span t-esc="'%.2f' %line['credit']"/></td>
                                <td class="text-right"><span t-esc="'%.2f' %line['balance']"/></td>
                                <t t-set="total_debit" t-value="total_debit+line['debit']"/>
                                <t t-set="total_credit" t-value="total_credit+line['credit']"/>
                                <t t-set="total_balance" t-value="line['balance']"/>
                            </tr>

                        </t>
                            <tr>
                                <td colspan="2" class="text-right"><strong>Total</strong></td>
                                <td class="text-right"><span t-esc="'%.2f' %total_debit"/></td>
                                <td class="text-right"><span t-esc="'%.2f' %total_credit"/></td>
                                <td class="text-right"><span t-esc="'%.2f' %total_balance"/></td>
                            </tr>
                        </tbody>

                    </table>
                    </div>
                 <t t-set="signature" t-value="o.get_payment_signature()"/>

                 <div t-if="signature" class="row" style="margin-top:150px;">
                    <div class="col-4 text-left">

                        <strong><span style="text-decoration:overline" t-field="signature.signature1"/> </strong>
                    </div>
                    <div class="col-4 text-center">
                        <strong><span style="text-decoration:overline" t-field="signature.signature2"/></strong>
                    </div>
                    <div class="col-4 text-right">
                        <strong><span style="text-decoration:overline" t-field="signature.signature3"/> </strong>
                    </div>
                </div>
                </t>


        </t>
    </t>

    </template>
</odoo>