<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data>
		<template id="delivery_lines_inbound_outbound" name="Delivery Data">
			<t t-set="total_qty" t-value="0"/>
			<t t-set="total_qty_actual" t-value="0"/>
			<t t-set="total_qty_short_excess" t-value="0"/>
			<t t-set="th_style" t-value="'border-bottom: 1px solid #ddd !important;white-space:nowrap;'"/>
			<table t-if="o.state!='done'" class="table  table-sm" t-attf-style="color:{{style.text_color}};" >
				<thead t-attf-style="background-color:{{style.theme_color  if not style.transparent else 'transparent'}}; page-break-inside: avoid; color:{{style.theme_txt_color  if not style.transparent else style.text_color}};">
					<tr t-attf-style="font-size:{{int(style.body_font)+2}}px;page-break-inside: avoid !important; border-bottom: 1px solid {{style.text_color}} !important;">
						<th t-attf-style="{{th_style}}"> #SL</th>
						<th t-attf-style="{{th_style}}">Product<br/><span>Description</span></th>
<!--						t-if="style.show_img"-->
						<th  t-attf-style="{{th_style}}"> Barcode</th>
						<th t-attf-style="{{th_style}}"> Lot <br/><span>No.</span></th>
						<th class="text-center" t-attf-style="{{th_style}}">Container <br/><span>Number</span></th>
						<th class="text-center" t-attf-style="{{th_style}}">Production <br/><span>Date</span></th>
						<th class="text-center" t-attf-style="{{th_style}}">Expiration <br/><span>Date</span></th>
						<th class="text-center" t-attf-style="{{th_style}}">Qty</th>
						<th class="text-center" t-attf-style="{{th_style}}">Qty <br/><span>(Actual)</span></th>
						<th class="text-center" t-attf-style="{{th_style}}">Qty <br/><span>(S/E)</span></th>
						<th class="text-center" t-attf-style="{{th_style}}">Status</th>
					</tr>
				</thead>
				<tbody>
					<t t-foreach="o.move_lines" t-as="move">
						<tr t-attf-style="background-color:{{style.odd if (move_parity in 'odd' and not style.transparent) else (not style.transparent and style.even)  or 'transparent'}}; page-break-inside: avoid !important;">
							<td><span t-esc="move_index + 1"/></td>
							<td><span t-field="move.product_id"/></td>
							<td><span t-field="move.product_id.barcode"/></td>
							<td>
								<t t-foreach="move.move_line_ids" t-as="line">
									<span t-field="line.lot_id.name"/>
								</t>
							</td>
							<td><t t-foreach="move.move_line_ids" t-as="line">
									<span t-field="line.container_no"/>
								</t></td>
							<td>
								<t t-foreach="move.move_line_ids" t-as="line">
									<span t-field="line.production_date"/>
								</t>
							</td>
							<td>
								<t t-foreach="move.move_line_ids" t-as="line">
									<span t-field="line.expiration_date"/>
								</t>
							</td>

							<td class="text-right">
								<span t-field="move.product_uom_qty"/>
								<t t-set="total_qty" t-value="total_qty + move.product_uom_qty"/>
							</td>
							<td class="text-right">
								<span t-field="move.quantity_done"/>
								<t t-set="total_qty_actual" t-value="total_qty_actual + move.quantity_done"/>
							</td>
							<td class="text-right">
								<span t-field="move.short_excess_qty"/>
								<t t-if="move.short_excess_qty">
									<t t-set="total_qty_short_excess" t-value="total_qty_short_excess + move.short_excess_qty"/>
								</t>
							</td>
							<td>
								<span t-field="move.container_status"/>
							</td>
						</tr>
					</t>
				</tbody>
				<tfooter>
					<tr>
						<td colspan="6"></td>
						<td><b>Total</b></td>
						<td class="text-right"><b><t t-esc="total_qty"/></b></td>
						<td class="text-right"><b><t t-esc="total_qty_actual"/></b></td>
						<td class="text-right"><b><t t-esc="total_qty_short_excess"/></b></td>
					</tr>
				</tfooter>
			</table>
			<t t-set="backorder" t-value="False"/>
			<table t-if="o.move_line_ids and o.state=='done'" class="table  table-sm" t-attf-style="color:{{style.text_color}};" >
				<t t-set="has_serial_number" t-value="o.move_line_ids.mapped('lot_id')"/>
				<thead t-attf-style="background-color:{{style.theme_color  if not style.transparent else 'transparent'}}; page-break-inside: avoid; color:{{style.theme_txt_color  if not style.transparent else style.text_color}};">
					<tr t-attf-style="font-size:{{int(style.body_font)+2}}px;page-break-inside: avoid !important; border-bottom: 1px solid {{style.text_color}} !important;">
						<th t-attf-style="{{th_style}}"> #SL</th>
						<th t-attf-style="{{th_style}}">Product<br/><span>Description</span></th>
<!--						t-if="style.show_img"-->
						<th  t-attf-style="{{th_style}}"> Barcode</th>
						<th t-attf-style="{{th_style}}"> Lot <br/><span>No.</span></th>
						<th class="text-center" t-attf-style="{{th_style}}">Container <br/><span>Number</span></th>
						<th class="text-center" t-attf-style="{{th_style}}">Production <br/><span>Date</span></th>
						<th class="text-center" t-attf-style="{{th_style}}">Expiration <br/><span>Date</span></th>
						<th class="text-center" t-attf-style="{{th_style}}">Qty</th>
						<th class="text-center" t-attf-style="{{th_style}}">Qty <br/><span>(Actual)</span></th>
						<th class="text-center" t-attf-style="{{th_style}}">Qty <br/><span>(S/E)</span></th>
						<th class="text-center" t-attf-style="{{th_style}}">Status</th>
					</tr>
				</thead>
				<tbody>
					<t t-foreach="o.move_lines" t-as="move">
						<tr t-attf-style="background-color:{{style.odd if (move_parity in 'odd' and not style.transparent) else (not style.transparent and style.even)  or 'transparent'}}; page-break-inside: avoid !important;">
							<td><span t-esc="move_index + 1"/></td>
							<td><span t-field="move.product_id"/></td>
							<td><span t-field="move.product_id.barcode"/></td>
							<td>
								<t t-foreach="move.move_line_ids" t-as="line">
									<span t-field="line.lot_id.name"/>
								</t>
							</td>
							<td>
								<t t-foreach="move.move_line_ids" t-as="line">
									<span t-field="line.container_no"/>
								</t>
							</td>
							<td>
								<t t-foreach="move.move_line_ids" t-as="line">
									<span t-field="line.production_date"/>
								</t>
							</td>
							<td>
								<t t-foreach="move.move_line_ids" t-as="line">
									<span t-field="line.expiration_date"/>
								</t>
							</td>

							<td class="text-right">
								<span t-field="move.product_uom_qty"/>
								<t t-set="total_qty" t-value="total_qty + move.product_uom_qty"/>
							</td>
							<td class="text-right">
								<span t-field="move.quantity_done"/>
								<t t-set="total_qty_actual" t-value="total_qty_actual + move.quantity_done"/>
							</td>
							<td class="text-right">
								<span t-field="move.short_excess_qty"/>
								<t t-if="move.short_excess_qty">
									<t t-set="total_qty_short_excess" t-value="short_excess_qty + move.short_excess_qty"/>
								</t>
							</td>
							<td>
								<span t-field="move.container_status"/>
							</td>
						</tr>
					</t>
				</tbody>
				<tfooter>
					<tr>
						<td colspan="6"></td>
						<td><b>Total</b></td>
						<td class="text-right"><b><t t-esc="total_qty"/></b></td>
						<td class="text-right"><b><t t-esc="total_qty_actual"/></b></td>
						<td class="text-right"><b><t t-esc="total_qty_short_excess"/></b></td>
					</tr>
				</tfooter>
				<p t-if="o.backorder_id">
						This shipment is a backorder of <t t-esc="o.backorder_id.name"/>.
				</p>
				<p>
						<t t-if="o.backorder_ids and o.backorder_ids.filtered(lambda x: x.state not in ('done', 'cancel'))">
								All items couldn't be shipped, the remaining ones will be shipped as soon as they become available.
						</t>
				</p>
			</table>
		</template>
	</data>
</odoo>

